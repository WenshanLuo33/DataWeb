<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Choropleth Map with Zoom-Level Data</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.10.0/mapbox-gl.js"></script>
    <style>
      /* âœ… è®©åœ°å›¾å¡«æ»¡å±å¹• */
      body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
      #map { position: absolute; top: 50px; left: 0; width: 100%; height: calc(100vh - 50px); }

      /* âœ… å›ºå®šå¯¼èˆªæ  */
      .navbar {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          background: rgba(255, 255, 255, 0.95);
          padding: 10px 20px;
          display: flex;
          justify-content: center;
          gap: 30px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          z-index: 1000;
      }

      .navbar a {
          text-decoration: none;
          color: black;
          font-size: 1rem;
          font-weight: bold;
          transition: color 0.3s;
      }

      .navbar a:hover {
          color: gray;
          text-decoration: underline;
      }

      /* âœ… è®© legend æ˜¾ç¤ºåœ¨å·¦ä¾§ */
      .legend {
          position: absolute;
          bottom: 30px;
          left: 20px; /* âœ… ç”± right æ”¹æˆ left */
          width: 320px;
          max-height: 430px; /* âœ… é™åˆ¶ legend é«˜åº¦ï¼Œé¿å…è¿‡é•¿ */
          overflow-y: auto; /* âœ… å…è®¸æ»šåŠ¨ */
          background: rgba(255, 255, 255, 0.9);
          padding: 15px;
          border-radius: 8px;
          font-size: 12px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .legend h3 {
          font-size: 16px;
          font-weight: bold;
          margin-bottom: 10px;
      }

      .legend p {
          font-size: 12px;
          color: #555;
          line-height: 1.4;
          text-align: left;
          margin-bottom: 10px;
      }

      .legend h4 {
          font-size: 14px;
          font-weight: bold;
          margin: 10px 0 5px;
          color: #333;
      }

      .legend div {
          display: flex;
          align-items: center;
          margin-bottom: 5px;
      }

      .legend div span {
          width: 12px;
          height: 12px;
          margin-right: 8px;
          display: inline-block;
          border-radius: 3px;
      }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <a class="nav-title" href="../index.html">Wen 3</a>
      <a class="nav-link" href="../pages/about.html">About</a>
      <a class="nav-link" href="../pages/writing.html">Writing</a>
      <a class="nav-link" href="mailto:wl763@cornell.edu">Contact</a>
    </nav>
  </header>

  <!-- ä¿¡æ¯æ¡†ï¼ˆæ ‡é¢˜å’Œæè¿°ï¼‰ -->

<div id="map"></div>


<!-- Census County Legend -->
<div id="county-legend" class="legend" style="display: none">
  <h3>Commuting Time Across the U.S.</h3>
  <p>This map visualizes "aggregate travel time to work (in minutes)" using data from the 'Census Bureau's ACS Table B08013'. Metropolitan areas have longer commuting times, such as NYC, Chicago, and Washington, D.C. 
    
    In this dataset, we did have data for California, Colorado, Arizona, Arkansas, Alabama and Connecticut</p>
  <hr>
  <h4>Commuters Count (County)</h4>
  <div><span style="background-color: #8B5A65"></span> 50,000,000+</div>
  <div><span style="background-color: #A7727D"></span> 25,000,000</div>
  <div><span style="background-color: #C08591"></span> 10,000,000</div>
  <div><span style="background-color: #D8A29E"></span> 5,000,000</div>
  <div><span style="background-color: #E8C2CA"></span> 1,000,000</div>
  <div><span style="background-color: #F2D4D7"></span> 500,000</div>
  <div><span style="background-color: #F6E7E6"></span> 100,000</div>
  <div><span style="background-color: #F9EFED"></span> 10,000</div>
  <div><span style="background-color: #FCF6F5"></span> 1,065+</div>
</div>

 <!-- State Legend -->
 <div id="state-legend" class="legend">
    <h3>Commuting Time Across the U.S.</h3>
    <p>This map visualizes "aggregate travel time to work (in minutes)" using data from the 'Census Bureau's ACS Table B08013'. The three states with the longest commuting times are New York, Texas, and Florida. 
        
        In this dataset, we did have data for California, Colorado, Arizona, Arkansas, Alabama and Connecticut</p>
    <hr>
    <h4>Commuters Count (State)</h4>
    <div><span style="background-color: #8B5A65"></span> 300,000,000+</div>
    <div><span style="background-color: #A7727D"></span> 250,000,000</div>
    <div><span style="background-color: #C08591"></span> 200,000,000</div>
    <div><span style="background-color: #D8A29E"></span> 150,000,000</div>
    <div><span style="background-color: #E8C2CA"></span> 100,000,000</div>
    <div><span style="background-color: #F2D4D7"></span> 50,000,000</div>
    <div><span style="background-color: #F6E7E6"></span> 10,000,000</div>
    <div><span style="background-color: #F9EFED"></span> 5,000,000</div>
    <div><span style="background-color: #FCF6F5"></span> 4,790,000+</div>
  </div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1Ijoid2VuMyIsImEiOiJjbTZpZGk0dDYwNnhqMm1vaGNtc2pyc29pIn0.R1YUPm_wlHzWpnWvsp8dIQ';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/wen3/cm7chdf7x002z01qo51indd1p',
    center: [-98, 38.88],  // åœ°å›¾åˆå§‹ä¸­å¿ƒç‚¹
    zoom: 3,               // åœ°å›¾åˆå§‹ç¼©æ”¾çº§åˆ«
    minZoom: 3.5,            // âœ… é™åˆ¶æœ€å°ç¼©æ”¾çº§åˆ«ï¼ˆä¸è®©ç”¨æˆ·ç¼©å°åˆ°å…¨çƒçº§åˆ«ï¼‰
    maxZoom: 10            // âœ… é™åˆ¶æœ€å¤§ç¼©æ”¾çº§åˆ«ï¼ˆä¸è®©ç”¨æˆ·æ”¾å¤§åˆ°è¿‡äºç»†èŠ‚ï¼‰
});

  const zoomThreshold = 5;

  map.on('load', () => {
      // Load Counties
      map.addSource('counties', {
          type: 'geojson',
          data: 'data/census_counties_final.geojson'
      });
      
      // Load states
      map.addSource('states', {
          type: 'geojson',
          data: 'data/census_states_final.geojson'
      });


      // ğŸ“Œ æ›´æ–° **states Layer** é¢œè‰²ï¼ˆç²‰çº¢è‰²ç³»ï¼‰
      map.addLayer({
          id: 'state-layer',
          type: 'fill',
          source: 'states',
          maxzoom: zoomThreshold,
          paint: {
              'fill-color': [
                  'interpolate', ['linear'], ['get', 'B08013_001E'],
                  4790000, '#FCF6F5',    // æœ€çŸ­é€šå‹¤æ—¶é—´ï¼ˆæµ…ç²‰ï¼‰
                  5000000, '#F8BBD0',
                  10000000, '#F9EFED',
                  50000000, '#F2D4D7',
                  100000000, '#E8C2CA',
                  150000000, '#D8A29E',
                  200000000, '#C08591',
                  250000000, '#A7727D',
                  300000000, '#8B5A65'  // æœ€é•¿é€šå‹¤æ—¶é—´ï¼ˆé…’çº¢ï¼‰
              ],
              'fill-opacity': 0.8
          }
      });


      // ğŸ“Œ æ›´æ–° **County Layer** é¢œè‰²ï¼ˆç²‰çº¢è‰²ç³»ï¼‰
      map.addLayer({
          id: 'county-layer',
          type: 'fill',
          source: 'counties',
          minzoom: zoomThreshold,
          paint: {
              'fill-color': [
                  'interpolate', ['linear'], ['get', 'B08013_001E'],
                  1000, '#FCF6F5',   // æœ€çŸ­é€šå‹¤æ—¶é—´ï¼ˆæµ…ç²‰ï¼‰
                  50000, '#F8BBD0',
                  100000, '#F9EFED',
                  500000, '#F2D4D7',
                  1000000, '#E8C2CA',
                  5000000, '#D8A29E',
                  10000000, '#C08591',
                  25000000, '#A7727D',
                  50000000, '#8B5A65'  // æœ€é•¿é€šå‹¤æ—¶é—´ï¼ˆé…’çº¢ï¼‰
              ],
              'fill-opacity': 0.8
          }
      });

      
      // Toggle legend based on zoom level
      const countyLegend = document.getElementById('county-legend');
      const stateLegend = document.getElementById('state-legend');

      map.on('zoom', () => {
          if (map.getZoom() > zoomThreshold) {
              countyLegend.style.display = 'block';
              stateLegend.style.display = 'none';
          } else {
              countyLegend.style.display = 'none';
              stateLegend.style.display = 'block';
          }
      });


      // âœ… æ·»åŠ  Popup åŠŸèƒ½
      const popup = new mapboxgl.Popup({
          closeButton: false,
          closeOnClick: false
      });

      function showPopup(e, layerId, featureNameProp) {
          const features = map.queryRenderedFeatures(e.point, { layers: [layerId] });
          if (!features.length) {
              popup.remove();
              return;
          }

          const feature = features[0];
          const name = feature.properties[featureNameProp];  // å–åç§°å­—æ®µï¼ˆState Name æˆ– County Nameï¼‰
          const commuteTime = feature.properties.B08013_001E;  // é€šå‹¤æ—¶é—´æ•°æ®

          popup.setLngLat(e.lngLat)
               .setHTML(`<strong>${name}</strong><br>Commuting Time: ${commuteTime} minutes`)
               .addTo(map);
      }

      // âœ… ç›‘å¬ State å±‚é¼ æ ‡ç§»åŠ¨äº‹ä»¶
      map.on('mousemove', 'state-layer', (e) => {
          showPopup(e, 'state-layer', 'NAME_y');  // å‡è®¾ State åç§°å­—æ®µæ˜¯ "NAME"
      });

      // âœ… ç›‘å¬ County å±‚é¼ æ ‡ç§»åŠ¨äº‹ä»¶
      map.on('mousemove', 'county-layer', (e) => {
          showPopup(e, 'county-layer', 'NAME_y');  // å‡è®¾ County åç§°å­—æ®µæ˜¯ "NAME"
      });

      // âœ… ç›‘å¬é¼ æ ‡ç§»å‡ºæ—¶éšè— Popup
      map.on('mouseleave', 'state-layer', () => popup.remove());
      map.on('mouseleave', 'county-layer', () => popup.remove());
  });
</script>

</body>
</html>